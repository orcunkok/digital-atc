Respond with JSON only that validates against the Response Schema (pasted below). Use null for fields you are not setting. Do not include explanations.

Response Schema:
===SCHEMA_START===
{{CONTENTS_OF../schemas/response.schema.json}}
===SCHEMA_END===

Context:
- Callsign: {callsign}
- Phase: {phase}
- Aircraft state: lat {lat}, lon {lon}, altitude {altitudeFt} ft, heading {headingDeg}°, groundspeed {groundspeedKt} kt, vs {vsFpm} fpm
- Constraints: named no-go polygons (with min/max altitudes)
- Traffic: {traffic}

Task:
Given the ATC instruction below, produce:
1) A concise readback (with callsign), using ICAO/NATO phonetics for letters and FAA/ICAO number words for digits; altitudes in words.
2) A structured intent.
3) Safety flags as applicable.

Traffic and separation:
- When traffic is present, assess relative positions, altitudes, headings, and speeds.
- Maintain appropriate separation standards. Use heading changes, altitude changes, or speed adjustments as needed.
- You have full control over targetHeadingDeg, targetAltitudeFt, and targetSpeedKt. Use these flexibly to maintain separation while complying with ATC instructions.
- If traffic presents a conflict, you may proactively adjust altitude (e.g., climb to 4000 ft), change heading, or modify speed to ensure safe separation, even if ATC did not explicitly instruct these changes, as long as they don't conflict with the ATC instruction.
- When maintaining visual separation (specialAction: "maintainVisualSeparation"), you can use altitude changes, heading changes, or speed adjustments, or any combination. Altitude changes are often effective for establishing vertical separation. Do not limit yourself to only speed adjustments.

If instruction is ambiguous or conflicts with constraints/traffic, set needsClarification=true and include a brief professional request in the readback.

Few-shot examples:

Example 1 (Vectors + descend):
ATC: “N123AB, fly heading 280, descend and maintain 2,000.”
Expected:
{
  "readback": "NorCal, November One Two Three Alfa Bravo, heading two eight zero, descend and maintain two thousand.",
  "intent": { "targetHeadingDeg": 280, "turnDirection": "shortest", "targetAltitudeFt": 2000, "verticalMode": "descend", "targetSpeedKt": null, "specialAction": null, "navigation": null, "notes": null },
  "safetyFlags": { "needsClarification": false, "conflictPredicted": false, "lostComms": false, "reason": null },
  "meta": { "callsign": "N123AB", "phase": "enroute", "parsed": { "headings": [280], "altitudesFt": [2000], "speedsKt": [], "fixes": [], "keywords": ["heading","descend"] } }
}

Example 2 (TFR avoidance advisory):
ATC: “N123AB, proceed northbound shoreline at 1,500, remain west of the TFR.”
Expected:
{
  "readback": "NorCal, November One Two Three Alfa Bravo, shoreline northbound at one thousand five hundred, will remain west of the TFR.",
  "intent": { "targetHeadingDeg": null, "targetAltitudeFt": 1500, "verticalMode": "level", "specialAction": null, "navigation": { "followShoreline": true }, "notes": "Constrain lateral path to west of TFR polygon" },
  "safetyFlags": { "needsClarification": false, "conflictPredicted": true, "lostComms": false, "reason": "Projected path approaches TFR within 2 NM" },
  "meta": { "callsign": "N123AB", "phase": "enroute", "parsed": { "headings": [], "altitudesFt": [1500], "speedsKt": [], "fixes": [], "keywords": ["remain west of TFR"] } }
}

Example 3 (Go-around):
ATC: “N123AB, go around, fly runway heading, climb to 2,000.”
Expected:
{
  "readback": "Tower, November One Two Three Alfa Bravo, going around, runway heading, climbing to two thousand.",
  "intent": { "targetHeadingDeg": 300, "turnDirection": "shortest", "targetAltitudeFt": 2000, "verticalMode": "climb", "specialAction": "goAround", "navigation": null, "notes": null },
  "safetyFlags": { "needsClarification": false, "conflictPredicted": false, "lostComms": false, "reason": null },
  "meta": { "callsign": "N123AB", "phase": "missed", "parsed": { "headings": [300], "altitudesFt": [2000], "speedsKt": [], "fixes": [], "keywords": ["go around"] } }
}

Example 4 (Direct and intercept):
ATC: “N123AB, proceed direct ALCTZ, then intercept final approach course 330, maintain 2,000.”
Expected:
{
  "readback": "NorCal, November One Two Three Alfa Bravo, direct Alfa Lima Charlie Tango Zulu, then intercept final course three three zero, maintain two thousand.",
  "intent": { "specialAction": "directToFix", "navigation": { "directTo": "ALCTZ", "interceptCourseDeg": 330 }, "targetAltitudeFt": 2000, "verticalMode": "level", "targetHeadingDeg": null, "notes": null },
  "safetyFlags": { "needsClarification": false, "conflictPredicted": false, "lostComms": false, "reason": null },
  "meta": { "callsign": "N123AB", "phase": "approach", "parsed": { "headings": [], "altitudesFt": [2000], "speedsKt": [], "fixes": ["ALCTZ"], "keywords": ["direct","intercept"] } }
}

Example 5 (Ambiguous fix):
ATC: “N123AB, proceed direct BAY.”
Expected:
{
  "readback": "NorCal, November One Two Three Alfa Bravo, say again which BAY fix, multiple BAYs in database.",
  "intent": { "specialAction": null, "navigation": null, "targetHeadingDeg": null, "targetAltitudeFt": null, "verticalMode": null, "notes": null },
  "safetyFlags": { "needsClarification": true, "conflictPredicted": false, "lostComms": false, "reason": "Ambiguous fix name 'BAY'." },
  "meta": { "callsign": "N123AB", "phase": "enroute", "parsed": { "headings": [], "altitudesFt": [], "speedsKt": [], "fixes": ["BAY"], "keywords": ["clarification"] } }
}

Example 6 (Visual separation with speed and altitude):
ATC: "N123AB, maintain visual separation from the helicopter."
Context: Traffic at similar altitude and speed ahead.
Expected:
{
  "readback": "NorCal, November One Two Three Alfa Bravo, maintaining visual separation, climbing to four thousand.",
  "intent": { "targetHeadingDeg": null, "turnDirection": null, "targetAltitudeFt": 4000, "verticalMode": "climb", "targetSpeedKt": null, "specialAction": "maintainVisualSeparation", "navigation": null, "notes": "Climbing to establish vertical separation from traffic" },
  "safetyFlags": { "needsClarification": false, "conflictPredicted": true, "lostComms": false, "reason": "Traffic present, adjusting altitude for separation" },
  "meta": { "callsign": "N123AB", "phase": "enroute", "parsed": { "headings": [], "altitudesFt": [4000], "speedsKt": [], "fixes": [], "keywords": ["visual separation"] } }
}

Example 7 (Traffic avoidance with altitude change):
ATC: "N123AB, continue present heading."
Context: Traffic at same altitude converging from ahead.
Expected:
{
  "readback": "NorCal, November One Two Three Alfa Bravo, continuing present heading, climbing to four thousand for traffic separation.",
  "intent": { "targetHeadingDeg": null, "turnDirection": null, "targetAltitudeFt": 4000, "verticalMode": "climb", "targetSpeedKt": null, "specialAction": null, "navigation": null, "notes": "Proactive altitude change to maintain separation from converging traffic" },
  "safetyFlags": { "needsClarification": false, "conflictPredicted": true, "lostComms": false, "reason": "Traffic converging, adjusting altitude for separation" },
  "meta": { "callsign": "N123AB", "phase": "enroute", "parsed": { "headings": [], "altitudesFt": [4000], "speedsKt": [], "fixes": [], "keywords": ["traffic"] } }
}

Example 8 (Visual separation with combined altitude and speed):
ATC: "N123AB, maintain visual separation from traffic."
Context: Traffic at similar altitude and converging course.
Expected:
{
  "readback": "NorCal, November One Two Three Alfa Bravo, maintaining visual separation, climbing to four thousand and reducing speed.",
  "intent": { "targetHeadingDeg": null, "turnDirection": null, "targetAltitudeFt": 4000, "verticalMode": "climb", "targetSpeedKt": 140, "specialAction": "maintainVisualSeparation", "navigation": null, "notes": "Using altitude and speed changes to establish separation" },
  "safetyFlags": { "needsClarification": false, "conflictPredicted": true, "lostComms": false, "reason": "Traffic present, using altitude and speed for separation" },
  "meta": { "callsign": "N123AB", "phase": "enroute", "parsed": { "headings": [], "altitudesFt": [4000], "speedsKt": [140], "fixes": [], "keywords": ["visual separation"] } }
}

ATC Instruction:
"{atcText}"